{% extends "base.html" %}
{% block title %}Клиенты{% endblock %}

{% block head_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/clients.css') }}" />

<style>
    .add-client-btn {
        background-color: #EAA21B;
        color: white;
        font-weight: bold;
        padding: 8px 20px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        transition: background-color 0.2s;
        text-decoration: none;
        font-size: 14px;
    }
    .add-client-btn:hover {
        background-color: #d3951e;
        color: white;
    }
    
    .btn-danger {
        background: #f44336;
        color: white;
        border: none;
        cursor: pointer;
        padding: 5px 10px;
        border-radius: 4px;
        font-size: 14px;
    }
    .btn-danger:hover {
        background: #d32f2f;
    }

    /* --- (НОВЫЙ БЛОК СТИЛЕЙ) --- */
    /* Контейнер для формы в таблице */
    .styled-input-form {
        display: flex;
        width: 180px; /* Общая ширина */
        background-color: #ececec; /* Светло-серый фон */
        border-radius: 4px;
        overflow: hidden; /* (Для скругления углов) */
        border: 1px solid #ccc; 
    }
    
    /* Поле для ввода номера */
    .styled-input-form input[type="number"] {
        flex-grow: 1; /* (Занимает все свободное место) */
        width: 100px; /* (Начальная ширина) */
        border: none;
        background: transparent;
        padding: 8px 12px;
        font-size: 16px;
        color: #333; /* Темный текст */
        outline: none;
    }
    .styled-input-form input[type="number"]::placeholder {
        color: #888;
    }
    
    /* Убираем стрелочки (spinners) в Chrome, Safari, Edge */
    .styled-input-form input[type="number"]::-webkit-outer-spin-button,
    .styled-input-form input[type="number"]::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
    }
    /* Убираем стрелочки в Firefox */
    .styled-input-form input[type="number"] {
        -moz-appearance: textfield;
    }

    /* Кнопка "ОК" */
    .styled-input-form input[type="submit"] {
        background: #EAA21B; /* Золотой цвет */
        color: #212121; /* Темный текст */
        border: none;
        cursor: pointer;
        padding: 8px 18px; /* Отступы */
        font-weight: bold;
        font-size: 14px;
        border-radius: 0; /* (Кнопка является частью контейнера) */
        transition: background-color 0.2s;
    }
    .styled-input-form input[type="submit"]:hover {
        background: #d3951e;
    }
    /* --- КОНЕЦ НОВОГО БЛОКА --- */

</style>
{% endblock %}


{% block content %}
<section class="clients-content">
    
    {% if search_term %}
        <div style="margin-bottom: 15px; padding: 10px; background: #fff; border: 1px solid #ddd; border-radius: 4px;">
            <span class="font-medium">Результаты по запросу: "{{ search_term }}"</span>
            <a href="{{ url_for('clients_page') }}" style="margin-left: 15px; color: #f44336; text-decoration: none;">Сбросить фильтр</a>
        </div>
    {% endif %}

    <div class="clients-header" style="justify-content: space-between; align-items: center;">
        <div class="font-medium text-lg">Клиенты</div>
        <a href="{{ url_for('register_client_page') }}" class="add-client-btn">
            Зарегистрировать клиента
        </a>
    </div>

    <div class="clients-table-container">
        <table class="clients-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Имя пользователя</th>
                    <th>Баланс (тг)</th>
                    <th>Время (сек)</th>
                    <th>Пополнить баланс</th>
                    <th>Добавить время (минуты)</th>
                    <th>Действия</th> 
                </tr>
            </thead>
            <tbody>
                {% for user in users %}
                <tr>
                    <td>{{ user.id }}</td>
                    <td>{{ user.username }}</td>
                    <td>{{ user.balance }}</td>
                    <td>{{ user.time_left }}</td>
                    <td>
                        <form class="styled-input-form" action="{{ url_for('web_add_balance') }}" method="POST">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                            <input type="hidden" name="username" value="{{ user.username }}">
                            <input type="number" name="amount" placeholder="500">
                            <input type="submit" value="OK">
                        </form>
                    </td>
                    <td>
                        <form class="styled-input-form" action="{{ url_for('web_add_time') }}" method="POST">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                            <input type="hidden" name="username" value="{{ user.username }}">
                            <input type="number" name="minutes" placeholder="60">
                            <input type="submit" value="OK">
                        </form>
                    </td>
                    <td>
                        <form action="{{ url_for('delete_user', user_id=user.id) }}" method="POST" style="margin:0;">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                            <button type="submit" 
                                    class="btn-danger" 
                                    onclick="return confirm('Вы уверены, что хотите удалить пользователя {{ user.username }}? Это действие необратимо.')">
                                Удалить
                            </button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</section>
{% endblock %}