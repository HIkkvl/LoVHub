{% extends "base.html" %}
{% block title %}Дашборд{% endblock %}

{% block head_css %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
{% endblock %}

{% block content %}
<section class="dashboard-content dashboard">
    
    <div class="dashboard-stats-bar">
        <div class="stat-item">
            <i class="fas fa-desktop"></i>
            <span>Компьютеры : {{ stats.total_computers }}</span>
        </div>
        <div class="stat-item">
            <i class="fas fa-check-circle"></i>
            <span>Включены : {{ stats.enabled_computers }}</span>
        </div>
        <div class="stat-item">
            <i class="fas fa-exclamation-triangle"></i>
            <span>Ошибки : {{ stats.disabled_computers }}</span>
        </div>
    </div>

    <div class="dashboard-panels-row">

        <div class="dashboard-left-column">

            <div class="dashboard-panel small-panel">
                <h2>Ключевые метрики</h2>
                
                <div class="metrics-icons-row">
                    <div class="metric-icon-box">
                        <i class="fas fa-users"></i>
                        <div class="metric-number">{{ stats.users_count }}</div>
                        <div class="metric-label">Клиенты</div>
                    </div>
                    <div class="metric-icon-box">
                        <i class="fas fa-gamepad"></i>
                        <div class="metric-number">{{ stats.apps_count }}</div>
                        <div class="metric-label">Приложения</div>
                    </div>
                    <div class="metric-icon-box">
                        <i class="fas fa-star"></i>
                        <div class="metric-number">{{ stats.top_app_count }}</div>
                        <div class="metric-label" title="{{ stats.top_app_name }}">
                            Топ: {% if stats.top_app_name|length > 10 %}{{ stats.top_app_name[:10] }}...{% else %}{{ stats.top_app_name }}{% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <div class="dashboard-panel large-panel" id="revenue-panel">
                <h2>Выручка (сегодня)</h2>
                
                <div class="revenue-list">
                    <div class="revenue-list-item">
                        <span>Общая выручка</span>
                        <span class="badge-revenue">{{ stats.revenue_total }} тг</span>
                    </div>
                     <div class="revenue-list-item">
                        <span>Онлайн (Kaspi)</span>
                        <span class="badge-revenue">{{ stats.revenue_kaspi }} тг</span>
                    </div>
                     <div class="revenue-list-item">
                        <span>Продажа пакетов</span>
                        <span class="badge-revenue">{{ stats.revenue_packages }} тг</span>
                    </div>
                </div>
            </div>

        </div>
        <div class="dashboard-panel large-panel" id="errors-panel">
            <h2>Проблемные ПК (Оффлайн)</h2>
            <div class="log-list"> 
                {% if error_pcs %}
                    {% for pc in error_pcs %}
                        <div class="log-entry">
                            <span class="log-user">{{ pc.name_to_display }}</span>
                            {% if pc.name_to_display != pc.pc_name %}
                                <span class="log-action">({{ pc.pc_name }})</span>
                            {% endif %}
                            <span class="log-computer">Последний раз в сети: {{ pc.last_seen }}</span>
                        </div>
                    {% endfor %}
                {% else %}
                    <p style="color: #aaa;">Проблемных ПК не найдено. Все компьютеры в сети.</p>
                {% endif %}
            </div>
            <a href="{{ url_for('computers_page') }}" class="view-all-link">перейти к списку ПК</a>
        </div>

    </div>
</section>
{% endblock %}