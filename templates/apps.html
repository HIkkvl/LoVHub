{% extends "base.html" %}
{% block title %}Приложения{% endblock %}

{% block head_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/apps.css') }}" />
{% endblock %}

{% block content %}

<div id="addAppModal" class="modal-backdrop">
    <div class="modal-content">
        <span class="modal-close" id="closeAddModalBtn">&times;</span>
        <h2>Add Games</h2>
        
        <form class="app-form" action="{{ url_for('apps_page') }}" method="POST" enctype="multipart/form-data">
            {{ form.hidden_tag() }} 
            
            <div class="image-upload-area" id="add-image-upload-area">
                <img src="#" alt="Image Preview" class="preview" style="display: none;">
                <svg class="upload-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg>
                <span class="upload-text">add image</span>
                <input type="file" name="icon" id="add_icon_file_input" accept="image/*">
            </div>

            <div>
                {{ form.name(placeholder="Name Game") }}
                {% for error in form.name.errors %}
                    <span class="error" style="color: #f88; font-size: 0.9em;">[{{ error }}]</span>
                {% endfor %}
            </div>
            <div>
                {{ form.path(placeholder="C:\Games\Game.exe (Скопируйте путь с сервера)") }}
                {% for error in form.path.errors %}
                    <span class="error" style="color: #f88; font-size: 0.9em;">[{{ error }}]</span>
                {% endfor %}
            </div>
            
            <div style="display: none;">
                <input type="hidden" name="type" value="game"> 
            </div>
            
            <div>
                {{ form.submit(value="+") }}
            </div>
        </form>
    </div>
</div>
<div id="editAppModal" class="modal-backdrop">
    <div class="modal-content">
        <span class="modal-close" id="closeEditModalBtn">&times;</span>
        <h2>Edit Game</h2>
        
        <form id="editAppForm" class="app-form" method="POST" enctype="multipart/form-data">
            <input type="hidden" name="csrf_token" id="edit_csrf_token">
            
            <div class="image-upload-area" id="edit-image-upload-area">
                <img src="#" alt="Image Preview" class="preview" style="display: none;">
                <svg class="upload-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg>
                <span class="upload-text">add image</span>
                <input type="file" name="icon" id="edit_icon_file_input" accept="image/*">
            </div>

            <div>
                <input type="text" name="name" id="edit_name" placeholder="Name Game">
            </div>
            <div>
                <input type="text" name="path" id="edit_path" placeholder="C:\Games\Game.exe (Скопируйте путь с сервера)">
            </div>
            
            <div style="display: none;">
                <input type="hidden" name="type" id="edit_type_hidden">
            </div>
            
            <div>
                <input type="submit" value="+">
            </div>
        </form>
    </div>
</div>
<section id="apps-container" 
         class="clients-content" 
         data-icon-base-url="{{ url_for('static', filename='icons/') }}"
         data-csrf-token="{{ csrf_token() }}">
    
    <div class="app-header">
        <div class="app-tabs">
            <button class="tab-link active" data-tab="games-list">Игры</button>
            <button class="tab-link" data-tab="apps-list">Приложения</button>
        </div>
        <button class="add-app-btn" id="openAddModalBtn">+</button>
    </div>
    
    <div class="app-list" id="games-list">
        {% for app in games %}
            <div class="app-item" 
                 style="{% if app.icon %}
                            background-image: url({{ url_for('static', filename='icons/' + app.icon) }});
                        {% else %}
                            background-color: #333; 
                        {% endif %}">
                
                <h3>{{ app.name }}</h3>
                <div class="actions">
                    <button class="btn-edit-app" data-app-id="{{ app.id }}">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                        </svg>
                    </button>
                </div>
            </div>
        {% else %}
            <p style="padding: 24px; color: #aaa;">Игры не добавлены.</p>
        {% endfor %}
    </div>
    
    <div class="app-list" id="apps-list" style="display: none;">
        {% for app in software %}
            <div class="app-item"
                 style="{% if app.icon %}
                            background-image: url({{ url_for('static', filename='icons/' + app.icon) }});
                        {% else %}
                            background-color: #333;
                        {% endif %}">

                <h3>{{ app.name }}</h3>
                <div class="actions">
                    <button class="btn-edit-app" data-app-id="{{ app.id }}">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                        </svg>
                    </button>
                </div>
            </div>
        {% else %}
            <p style="padding: 24px; color: #aaa;">Приложения не добавлены.</p>
        {% endfor %}
    </div>

</section>
{% endblock %}


{% block scripts %}
<script src="{{ url_for('static', filename='js/apps.js') }}" defer></script>
{% endblock %}